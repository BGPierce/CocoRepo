* Wildcards - adds widcard directory listing in RSDOS* By Richard Estrado* From the June 1989 issue of Rainbow*		ORG		$503BSTART	CLRA		LDX		#WILD		Load addr of WILD in X		STX		$C1F1		Store in JMP table entryWILD	LDA		[$A6]		Char currently being processed		CMPA	#'"			Is it (")?		BEQ		GTFN		If so, then get filename		LBRA	$CCA9		Else return to old DIRGTFN	LBSR	$C935		Get filename etc.		LDA		$094C		Get 1st char of fname		ADDA	$0954		Add 1st char of ext		CMPA	#84			Is it "*.*"?		LBEQ	$CCA9		If so, then go to old DIR** Set up DSKON parameters*		JSR		$C79D		Make sure FAT is valid		JSR		$B958		Print carriage return		LDD		#$1102		*		STA		$00EC		*		STB		$EB			*		LDB		#3			* Setup DSKON parmsSTORE	STB		$ED			*		LDX		#$600		* Point X to disk buffer		STX		$EE			*		JSR		$D6F2		Read a sectorCOMP	TFR		X,U			Copy X pointer to U		LDA		,X			Load 1st char of directory		BEQ		ADVAN		If 0 then advance pointer		COMA				Check end of directory; $FF		LBEQ	END			If it is, then end** Compare filename*SERCH1	LDY		#$094C		Point Y to the start of the filenameCOMP1	LDA		,Y			Load char of filename in A		CMPA	#'*			Is it an "*"?		LBEQ	SERCH2		If so, go search the extension		CMPA	,U+			Compare with data in I/O buffer		BNE		ADVAN		If mismatch, then advance		CMPY	#$953		Check for end of filename		BEQ		SERCH2		If at end, start EXT search		LEAY	1,Y			Increment filename pointer		JMP		COMP1		Loop to COMP1SERCH2	LEAX	8,X			Set X pointer to ext		TFR		X,U			Copy the value to U		LDY		#$954		Point Y to extCOMP2	LDA		,Y			Load char of ext in A		CMPA	#'*			Is it an "*"?		LBEQ	DUMP		If so, then dump the dir entry		CMPA	,U+			Compare char in I/O buffer		BEQ		COMP3		If match goto COMP3		LEAX	-8,X		Else reset the X pointer		BRA		ADVAN		And advance to next dir entryCOMP3	CMPY	#$956		Check for end of ext		BNE		NEXT		If it's not, then goto NEXT		BRA		DUMP		Else dump dir entryNEXT	LEAY	1,Y			Increment ext char pointer		JMP		COMP2		Loop to COMP2** Advance the directory pointer*ADVAN	LEAX	32,X		Inc main pointer buffer		CMPX	#$700		Are we at the end of the buffer?		BNE		COMP		If not, then loop to COMP		INCB				Increment sector pointer		CMPB	#11			Check with max sextor #		BLS		STORE		If>11 then goto STORE		RTS					If at the end, return to BASIC** Dump the directory line*DUMP	LEAX	-8,X		Re-adjust X pointer		PULS	U			Save top of stack		JSR		$A549		Go do a BREAK check		PSHS	U			Restore the stack		PSHS	B			Save B, sector pointer		PSHS	X			Save X, I/O buffer pointer		LDB		#8			*		JSR		$B9A2		*		JSR		$CD1B		*		LDB		#3			*		JSR		$B9A2		*		JSR		$CD1B		*		LDB		0,X			* This section of code		CMPB	#10			* Simply dumps the directory		LBCC	CLEAR		* entry which has passed the		LBSR	$CD1B		* comparison checks aboveCLEAR	CLRA				*		JSR		$BDCC		*		LBSR	$CD1B		*		LDX		,S			*		LDA		#$42		*		ADDA	12,X		*		LBSR	$CD18		*		LDB		13,X		*		LBSR	$CD1E		*		TFR		A,B			*		CLRA				*		JSR		$BDCC		*		JSR		$B958		*		PULS	X			Restore X		PULS	B			Restore B		BRA		ADVAN		Go advance pointerEND		RTS					Return to BASIC		END		