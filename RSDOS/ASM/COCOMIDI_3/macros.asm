 TITL1 "MACROS/TXT"* MACROS/TXT* General purpose macros* Written by Lester Hands, 1988S.LOCFL SET 0* Macro for declaring "local" variables.* Up to 5 2-byte variables may be declared.* S.LOCFL is set to 1*  LOCAL [V1,V2,V3,V4,V5]*LOCAL MACROS.LOCFL SET 1 flag set to 1S.OFS SET 0 IFSN |0,|0 SET S.OFSS.OFS SET S.OFS+2 ENDC IFSN |1,|1 SET S.OFSS.OFS SET S.OFS+2 ENDC IFSN |2,|2 SET S.OFSS.OFS SET S.OFS+2 ENDC IFSN |3,|3 SET S.OFSS.OFS SET S.OFS+2 ENDC IFSN |4,|4 SET S.OFSS.OFS SET S.OFS+2 ENDC IFSN |5, FAIL "ERROR--TOO MANY VARIABLES ",|4 ENDC ENDM* A macro to start a procedure; use after the* declaration of local variables. The declared* variables are all two bytes in length. As many as* four, or as few as none may be used. Space is* allocated on the stack for local variables.* S.LOCFL is checked to make sure it is set to 1*       LOCAL [V1,V2,V3,V4]* LABEL PROC [V1,V2,V3,V4]PROC MACRO IFNE S.LOCFL-1S.OFS SET 0 ENDC PSHS X,Y,U IFSN |0,|0 SET S.OFS+8 ENDC IFSN |1,|1 SET S.OFS+10 ENDC IFSN |2,|2 SET S.OFS+12 ENDC IFSN |3,|3 SET S.OFS+14 ENDC IFSN |4, FAIL "TOO MANY VARIABLES FOR PROC" ENDC IFNE S.OFS LEAS -S.OFS,S ENDCS.X SET S.OFS used for modifyingS.Y SET S.OFS+2 returned registerS.U SET S.OFS+4 values ENDM* A macro that marks the end of a procedure; local* variable storage is deallocated and control is* returned to calling routine* Clears the local flag*ENDP MACROS.LOCFL SET 0 IFNE S.OFS LEAS S.OFS,S ENDC FDB $35F0 ************        PULS    X,Y,U,PC ENDM* a macro that allows C-like calls to procedures* the procedure name is followed by a list of the* variables to be passed (0-4).* CALL ADDRESS[,V1,V2,V3,V4]*CALL MACROS.NUM SET 0 IFSN |5, FAIL "TOO MANY VARIABLES FOR CALL" ENDC IFSN |4, IFSE |4,REGX PSHS X ELSE LDD |4 PSHS D ENDCS.NUM SET S.NUM+2 ENDC IFSN |3, IFSE |3,REGX PSHS X ELSE LDD |3 PSHS D ENDCS.NUM SET S.NUM+2 ENDC IFSN |2, IFSE |2,REGX PSHS X ELSE LDD |2 PSHS D ENDCS.NUM SET S.NUM+2 ENDC IFSN |1, IFSE |1,REGX PSHS X ELSE LDD |1 PSHS D ENDCS.NUM SET S.NUM+2 ENDC LBSR |0 LEAS S.NUM,S ENDM* a macro for declaring a character "string"* only for use immediately after a LOCAL macro*  CHAR LABEL,LENGTH*CHAR MACRO|0 SET S.OFSS.OFS SET S.OFS+|1 ENDM* end of file: MACROS/TXT