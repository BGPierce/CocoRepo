/* file BN/BNOTE.C  --7--    Replaces DRNOTE.C, PUTNOTE.C*  Many pieces sent to fraggged ShowSubs.c 89/6/5*  Image-putter for notes & rests*  COL-X 88/11/7*/#include <stdio.h>#include "wmuse.h"#include "wcodes.h"#include "vmem.h"#include "screen.h"/* Non-graphic arrays */extern direct sexy     nstaves;extern STAFF   staves[];extern PART    parts[];extern ubyte   grafxes[], grafyes[];extern direct short     xyoff;extern direct char    *pct2, *pct3, *pct4, *pct5, *pct6, *pct7, *pctn1;/* "ArgBox" for faster piping to Fran.*  These MUST be kept contiguous and in order! */extern direct ubyte     arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9, arg10, arg11;/* Pipe-optimized 90/5/26 to cut data rate from 6, 11 to 5, 6.*  Originals are in frags/*//********************************************************* Draw a note, of style passed in structure,* at coordinates XC and Y. * Does not fudge Rests' Y; that's showall()'s job.*/drawnr(what, gxc,gy, staffy, stemdn, noflags, color)  NOTE  *what;      /* the note to draw */  sexy  gxc,gy,      /* where to draw it */        staffy;  bool  stemdn,     /* stem direction: TRUE==down */        noflags,    /* Don't draw the flags on stem */        color;      /* T==draw or F==erase */{/** DUR: Br,1,2,4,8,16,32,64. Limit=0-7* DurMod: Null  .  ..  Triplet.  Limit=0-3* Slot: -11 to 20; 32==Rest* PitMod: as in PRE$ array* Artic: see above array.  0==Tied*//* These bounds tests are PHYSICAL, just avoid blowing up OS9 */     if((gxc < 2) || (gxc > COLS-2) || (gy < 5) || (gy > HM1-5)       || (stemdn && (gy < 12)) || (!stemdn && (gy > HM1-12)) )          return;          /* out of bounds, save time */     arg1 = color;     arg2 = gxc;     arg3 = gy;     arg4 = (what->dur << 2) | what->durmod;     if(what->slot == REST) {          arg0 = DRST;          nfwrite(5); /* stdout arg supplied elsewhere */     }     else {          arg0 = DNOT;          arg1 |= what->pitmod << 3;          arg4 |= what ->artic << 5;          arg5 = staffy;           if(stemdn)     arg1 |= 2;          if(noflags)    arg1 |= 4;          nfwrite(6);     }} /* drawnr() *//**** Draw just the Artic part of a Note ***/drawart(c, xc, y, art, stemdn)  sexy    c, xc, y, art;  bool    stemdn;{     if(y < 0) y = 0;/*   printf(pct6, ART, c, xc, y, art, stemdn); */     arg0 = ART;     arg1 = c;     arg2 = xc;     arg3 = y;     arg4 = art;     arg5 = stemdn;     nfwrite(6);     flush();}/*************************** 88/6/6 Draws multi-digits DOWNWARDS of 1st digit.* Draw up to three BCD digits in vertical Chinese style.* XC,Y locate LOWER LEFT corner of TOP (most significant) digit.* Images are in char *inumers[11].*/drawbcd(num, xc, y)  short num;    sexy xc, y;{     printf(pct4, DBCD, xc, y, num);} /* drawbcd() *//*** Little Placement codes ***/givabort(give)  bool    give;{     printf(pct2, GABO, give);     flush();}getnback() {     printf(pctn1, GBG);     /* Fran expects the \n */}putnback() {     printf(pctn1, PBG);}#ifdef ASCALL/********************************* Debugging routine to text-print (ASCII) the buffer */ascall(){    int   i;    register EVENT *evi;    text();    printf("\n%d events.\n", nevents);    for(evi = i2p(0); curind < nevents; evi = plusplus() ) {        printf("EVT %3d Part=%d X,Y=(%3d,%3d)\n  StTime =%4d\n",          curind, evi->part,          grafxes[curind - xyoff], grafyes[curind - xyoff] & 255,          evi->startime);        prtnote(&evi->show);    }    hitenter();    wkill();   /* grafix(); */} /* ascall() */#endif/* eof ~VM640/BNOTE.C */ 