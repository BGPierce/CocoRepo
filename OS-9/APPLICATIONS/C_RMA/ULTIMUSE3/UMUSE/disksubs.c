/* vm640/DISKSUBS.c (was TITLES.C and MM/1:instio.c)*  Titles-window R/W code, pulled out of diskio.c 95/2/4*  Fran boilerplate fcns*/#include "wmuse.h"#include "vmem.h"#include "fcnptrs.h"#include "wcodes.h"#include "titles.h"extern long    lseek();extern char    instnams[NINSTRS] [10];extern short   instvals[NINSTRS];extern ubyte   *evtarray;extern direct char     *pct2, *pct4, *pct7, *pctn1, *pctn2;/* Convert single-char file-type code to .extent string.*  Returns *char to CodeSect, so treat it as R/O! */char *extent(ch)  char    ch;{     switch(ch) {     case 'u':          return(".ume");     case 'i':          return(".ins");     case 'p':          return(".per");     case 'l':          return(".lev");     case 'm':          return(".mid");     }     return("");    /* not the same as NULL! */} /* extent() *//* Test whether name ends in .ext, where ext must be lower case*  and is assumed '.' plus 3 chars. */bool extest(name, ext)  char    *name, *ext;{     char stemp[8];     int  len;     len = strlen(name) - 4;     if(len <= 0)          return(FALSE);     strcpy(stemp, name + len);     lower(stemp);     return( !strcmp(ext, stemp));} /* extest() *//* Clear instr arrays to value 128 (shows as 1, not o011) and NULL. */instinit() {     int       i;     Reg char  *cp;     for(i = NINSTRS, cp = instnams[0];  --i >= 0;  cp += INAMEL) {          instvals[i] = 0x80;          *cp = '\0';     }}/* Read thru a score and "swab" all the BARNO fields.*  Also fix any "alternate" Null or Natural PitMods,*    and any funny Artics (90/11/24) */void barswap(){     short     swabber;     sexy      pm;     Reg EVENT *evp;     for(evp = i2p(0); curind < nevents; evp = plusplus()) {          if( !evp->part) {               if(evp->show.INCTYPE <= FINE) {                    swabber = evp->show.BARNOLO;                 /* LDB */                    *((char *)(&swabber)) = evp->show.BARNOHI;   /* LDA */                    *((short *)(&(evp->show.BARNO))) = swabber;  /* STD */               }          }     /* Note/Rest */          else {     /* Normalize Naturals to 4, and Nothings to 0 */               if((pm = evp->show.pitmod & 7) == 1)                    pm = 0;               if(pm == 5)                    pm = 4;               evp->show.pitmod = pm;/* "Xenophobia" masks permit later versions to extend these fields *//* Not added till 97/2/18, damn! */               evp->show.dur &= 7;               evp->show.durmod &= 3;               evp->show.artic &= 7;    /* helps below too *//* As always, protect .artic, and no artics on Rests */               if( (evp->show.slot == REST) || (evp->show.artic >= NARTICS) )                    evp->show.artic = NORMAL;         }     } /* for */} /* barswap() *//* Append given .ext to name in place, unless name already ends in .ext *//* Used in diskio() and append() also. */addext(fname, ext)  char    *fname, *ext;{     if( !extest(fname, ext))          strcat(fname, ext);} /* Converts string to lower-case in place.*  Chars other than capitals are unchanged. */void lower(str)  char    *str;{     char ch;     for(ch = *str; ch; ch = *++str)          if((ch >= 'A') && (ch <= 'Z'))               *str = ch + ('a' - 'A');}/* Caller must swapevts() */void titleclr() {     int       i;     Reg char  *cp;     for(i = VTITLSIZ, cp = Titles; --i >= 0; )          *cp++ = '\0';} /* titleclr() *//********* Usual Fran routines *//* Open a Pat & Vanna overlay window */wcreate(leftcol, topy, colswide, rowshigh, dosave, style)  sexy    leftcol, topy, colswide, rowshigh, style;  bool    dosave;{     (*pprintf)(pct7, OWST, leftcol, topy, colswide, rowshigh, dosave, style);     (*pflush)();}/*** Close above window type ***/wkill() {     (*pprintf)(pctn1, OWEN);}alcurset(onoff)  bool    onoff;{     (*pprintf)(pctn2, ACUR, onoff);   }/* Clear entire screen to background */clear() {     (*pprintf)(pct2, CLA, 0);}fgstaff(st)  sexy    st;{     (*pprintf)(pct2, UDFS, st);}fgpart(p)  sexy    p;{     (*pprintf)(pct2, UDFP, p);}/* eof DISKSUBS.C */