/* ~VM640/TITLES.C  To handle Title/Info Banners */#include <stdio.h>#include "wmuse.h"#include "titles.h"#include "windows.h"#include "version.h"#include "vmem.h"#define MEGPRINT 1extern ubyte *evtarray;extern char     /* titles[TOTLINES][TLENP1], */     filename[];extern direct short     nbars, scorelvl;extern direct Time     length;extern direct sexy     numer, denom, nparts, nstaves;extern direct bool     readonly, midipak, mididev, midiser, compact, pldebug;/* Clear one line (just first and last bytes) *//* Caller must swapevts() */void tlineclr(line)  int     line;     /* Org Zero! */{     register char  *cp;     *(cp = Titles + (TLENP1 * line)) = '\0';     *(cp + TLEN) = '\0';}/* Clear title array */void titleclr() {     int  i;     swapevts(TRUE);     for(i = TOTLINES; --i >= 0; )          tlineclr(i);     swapevts(FALSE);}/* Show the lines, within an already-established window.  Free \n at end. */void titlinsho(nums)   bool    nums;{     int  line;     char *cp;     swapevts(TRUE);     cp = Titles;     for(line = 0; line < TOTLINES; line++, cp += TLENP1) {          if(nums)               printf("%d: ", line + 1);          printf("%s\n", cp);     }     swapevts(FALSE);     putchar('\n');}/* Show titles, complete with overlay window.  Fully free-standing. */void titlesho() {     int  line;     wcreate(40-TLEN/2, TWINTOPY, TLENP1+4, TOTLINES + 3, TRUE, WSSHADOW);     titlinsho(FALSE);     hitenter();     wkill();}/* Dodge pflinit() junk by printing Long numbers up to 9999,999*   as in 'length'.  Free comma thrown in. */megprint(buff, val)  Reg char     *buff;    /* must be at least 10 chars */  long         val;{     long      lquot, lrem, divor;     short     quot;     bool      already;#ifdef MEGPRINT     if(val < 0L)   val = -val;     already = FALSE;     for(divor = 1000000L; divor >= 1000L; divor /= 10L) {          quot = val / divor;                    if(quot) {               already = TRUE;               val = val - quot * divor;               *buff++ = quot + '0';          }          else if(already)               *buff++ = '0';     }/* Val is now < 999 */     sprintf(buff, already ? ",%03d" : "%3u", (short)val);#else     /* Temp code to do it in Hex */     sprintf(buff, "$%X%04X", *((int *)&val), *((unsigned *)&val + 1) );#endif}/* How'd this get in here?  By showing its Title: "Graf von Grafix" */void report() {     char buff[16];     int  line;     wcreate(39-TLEN/2, TWINTOPY, TLENP1+2, TOTLINES + 7, TRUE, WSSHADOW);     titlinsho(FALSE);     printf("UMusE-3 v%d.%d.%d%c  ",       UMLEVEL, SCLEVEL, RVLEVEL, RVSUBLET);     printf("'%s'%s\n", filename, readonly ? " (R/O)" : "");     printf("   Score Level %d.\n", scorelvl);     printf(" %d Parts on %d Staves; ", nparts, nstaves);     flush();     barenum(FALSE);      /* just count 'em */     megprint(buff, length);     printf("%d bars of %d/%d; %s Ticks\n", nbars, numer, denom, buff);     printf("%5d Objects Left; %5d Used, %2d Pages, %3d Sectors\n",       NEVENTS - nevents, nevents, nmpages, nevents / 32 + 2);/* serial, pak, compact, trace, readonly */     printf(" MIDI: Pak=%d, /dev=%d, Serial=%d.   Compact=%d   Debug=%d\n",       midipak, mididev, midiser, compact, pldebug);     hitenter();     wkill();}/* Show 'em but let user edit them too.  Also free-standing. *//* Needs to be mousified!!! */void titlemen() {     char buff[BUFFSIZE], ch;     int  line;     wcreate(40-TLEN/2-2, TWINTOPY, TLENP1+4, TOTLINES+3, TRUE, WSDOUBLE);     for(;;) {          titlinsho(TRUE);          printf(" (ENTER to quit) Line # to re-type: ");          charmaus(&ch);          /* readone(&ch); */          if(ch == '\n')               break;          line = ch - '1';    /* Org Zero */          if((line >= 0) && (line < TOTLINES)) {               printf("\n%d: ", line + 1);               gets(buff);               if(*buff) {                    swapevts(TRUE);                    tlineclr(line);     /* insures all NULL chars */                    *(buff + TLEN) = '\0';                    if(*(buff+1)||(*buff !=' ')) /* single Blank kills line */                         strncpy(Titles + TLENP1 * line, buff, TLENP1);                    swapevts(FALSE);               }          }          printf("\014");     }     wkill();} /* titlemen() *//* eof ~Vm640/titles.c */